<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <!-- <meta http-equiv="x-ua-compatible" content="ie=edge"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>个人设置</title>
    <link rel="stylesheet" href="../../css/foundation.6.3.0.css" />
    <!-- <link rel="stylesheet" href="css/icons.css" /> -->
    <link rel="stylesheet" href="https://static.runoob.com/assets/foundation-icons/foundation-icons.css">
    <link rel="stylesheet" href="../../css/app.css" />
    <style type="text/css">
        .container{
            width: 80%;
            margin: 20px auto;
        }
        .title-top{
            border-bottom: 1px solid #e8e6e8;
            /*text-align: center;*/
            background: #06c673;
            color: #fff;
            padding: 10px;
        }
        .title-top h5{
            font-size: 16px;
            font-weight: bold;
            height: 20px;
            line-height: 20px;
            margin-top: 2px;
            margin-left: -30px;
        }
        .row img{
            width: 200px;
            height: 200px;
            margin-top: 30px;
        }

    </style>
</head>
<body>
<div class="">
    <div class="row title-top">
        <div class="small-2 columns">
            <a href="" id="backto_center"><i class="fi-arrow-left float-left"></i></a>
        </div>
        <div class="small-10 columns">
            <h5 class="text-center">头像修改</h5>
        </div>
    </div>
    <div class="row">
        <div class="small-12 columns">
            <img id="touxiang" src="" class="float-center thumbnail" alt="tou xiang">
        </div>
    </div>
    <div class="container">
        <!--<button type="button" class="button success expanded">上传头像</button>-->
        <!--action="http://localhost:8080/PersonalGarden/index.php/Home/Qiniu/upload"-->
        <form id="img_form" method="post" action="" enctype="multipart/form-data">
            <input name="token" type="hidden" value="<upload_token>">
            <input id="token2" name="token2" type="hidden" value="">
            <input name="myfile" type="file" />
            <input id="submit"  type="submit" class="button success expanded" value="上传头像"/>
        </form>
    </div>
</div>

<script src="../../js/vendor/jquery.js"></script>
<script src="../../js/vendor/public.js"></script>
<script src="../../js/vendor/what-input.js"></script>
<script src="../../js/vendor/foundation.6.3.0.js"></script>
<script>
    $(document).foundation();
    $(function(){
//        var token = getQueryString("token");
        var token = localStorage.getItem("log_status");//从本地缓存取得token数据
        $("#token2").val(token);
//        alert(token);
        console.log(token);
        $("#backto_center").click(function(){//回退到个人中心界面
            $("#backto_center").attr("href","userinfor_setting.html");
        });
        if(token == null) {
//            alert(token);
            alert("请先登陆！");
            window.location.href = "login.html";
        }
        else {
            //获取用户信息
            $.get("http://localhost:8080/PersonalGarden/index.php/Home/Login/login/token/"+token, function(json) {
                if(json.resultcode == -2) {
                    alert("token已失效，请重新登录！");
                    window.location.href = "login.html";
                }
                else {
                    user_head = json.data.subitem[0].photo_url;//获取用户头像
                    if(user_head){
                        $("#touxiang").attr('src',user_head);
                    }
                }
            });
        }
//    alert(token);
//    var url = "http://localhost:8080/PersonalGarden/index.php/Home/Qiniu/upload/token/"+token;


        //修改并提交头像
        $("#img_form").submit(function(){
//           alert("head change");
            //jQuery设置action的值
            var url = "http://localhost:8080/PersonalGarden/index.php/Home/Qiniu/upload";
            $("#img_form").attr("action",url);
//            window.location.href("userinfor_setting.html");
        });
    });
</script>

</body>
</html>
